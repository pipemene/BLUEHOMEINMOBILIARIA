<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Blue Home | Gestor de Procesos - Login</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <div class="app-shell">
    <main class="app-card app-card--single">
      <section class="app-card__left">
        <div class="logo-row">
          <div class="logo-mark">
            <div class="logo-mark__chip">BH</div>
            <div class="logo-mark__text">
              <span class="logo-mark__title">BLUE HOME</span>
              <span class="logo-mark__subtitle">Gestor de procesos internos</span>
            </div>
          </div>
          <span class="chip">Versión inicial · Frontend</span>
        </div>

        <div class="badge">
          <span class="badge-dot"></span>
          <span>Acceso privado para equipo interno</span>
        </div>

        <header style="margin-top: 16px;">
          <h1 class="page-title">Ingreso al Gestor</h1>
          <p class="page-subtitle">
            Centraliza órdenes, técnicos y facturación en una sola vista interna.
          </p>
        </header>

        <form class="form" id="loginForm">
          <div class="field">
            <label for="email">Usuario</label>
            <input class="input" id="email" type="text" placeholder="usuario en Google Sheets" required />
          </div>

          <div class="field">
            <label for="password">Contraseña</label>
            <input class="input" id="password" type="password" placeholder="••••••••" required />
          </div>

          <div class="button-row">
            <span class="helper-text">
              Se valida contra la hoja de usuarios en Google Sheets.
            </span>
            <button class="button" type="submit">
              Entrar
              <span style="font-size: 16px;">→</span>
            </button>
          </div>
          <p class="helper-text" id="loginFeedback"></p>
        </form>

        <div class="notice">
          <strong>Nota:</strong> cuando terminemos el modelo de usuarios y roles, esta pantalla
          será el punto de entrada según perfil (admin, reparaciones, facturación, etc.).
        </div>
      </section>
    </main>
  </div>

  <script>
    const API_BASE_URL = 'http://localhost:8080/api';
    const form = document.getElementById('loginForm');
    const feedback = document.getElementById('loginFeedback');

    form.addEventListener('submit', async function (e) {
      e.preventDefault();
      feedback.textContent = 'Validando contra Google Sheets...';
      feedback.style.color = 'var(--muted)';

      try {
        const res = await fetch(`${API_BASE_URL}/login`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            email: document.getElementById('email').value,
            password: document.getElementById('password').value
          })
        });

        const data = await res.json();
        if (!res.ok || !data.success) {
          throw new Error(data.message || 'No se pudo iniciar sesión.');
        }

        localStorage.setItem('bhUser', JSON.stringify(data.data));
        feedback.textContent = 'Ingreso correcto, redireccionando...';
        feedback.style.color = 'var(--success)';
        window.location.href = './dashboard.html';
      } catch (err) {
        console.error(err);
        feedback.textContent = err.message || 'Error al validar credenciales.';
        feedback.style.color = 'var(--danger)';
      }
    });
  </script>
</body>
</html>
